import Foundation
import CoreLocation

class ApiManager {
    // Api docs here:
    // https://openweathermap.org/current
    // https://openweathermap.org/forecast5

    fileprivate static let API_KEY =  Bundle.main.object(forInfoDictionaryKey: "WEATHER_API_KEY") ?? "ADD_API_KEY_HERE"
    fileprivate static let BASE_URL = "https://api.openweathermap.org/data/2.5"
    fileprivate static let CURRENT_WEATHER_URL = "\(BASE_URL)/weather"
    fileprivate static let FIVE_DAY_FORECAST_URL = "\(BASE_URL)/forecast"

    // current weather data
    // curl --location 'https://api.openweathermap.org/data/2.5/weather?lat=37.785834&lon=-122.406417&appid=79b57cc4d773c37a59e5790c23979016'
    // {"coord":{"lon":-122.4064,"lat":37.7858},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"base":"stations","main":{"temp":284.73,"feels_like":284.29,"temp_min":282.84,"temp_max":286.21,"pressure":1024,"humidity":90,"sea_level":1024,"grnd_level":1020},"visibility":10000,"wind":{"speed":1.54,"deg":140},"clouds":{"all":75},"dt":1731430127,"sys":{"type":2,"id":2017837,"country":"US","sunrise":1731422844,"sunset":1731459630},"timezone":-28800,"id":5391959,"name":"San Francisco","cod":200}%

    // 5 day forecast
    // curl --location 'https://api.openweathermap.org/data/2.5/forecast?lat=37.785834&lon=-122.406417&appid=79b57cc4d773c37a59e5790c23979016'
    // {"cod":"200","message":0,"cnt":40,"list":[{"dt":1731434400,"main":{"temp":284.75,"feels_like":284.32,"temp_min":284.75,"temp_max":285.81,"pressure":1024,"sea_level":1024,"grnd_level":1020,"humidity":90,"temp_kf":-1.06},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":75},"wind":{"speed":1.63,"deg":4,"gust":1.58},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-12 18:00:00"},{"dt":1731445200,"main":{"temp":285.42,"feels_like":284.79,"temp_min":285.42,"temp_max":286.77,"pressure":1023,"sea_level":1023,"grnd_level":1018,"humidity":80,"temp_kf":-1.35},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":65},"wind":{"speed":1.2,"deg":327,"gust":1.56},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-12 21:00:00"},{"dt":1731456000,"main":{"temp":286.18,"feels_like":285.42,"temp_min":286.18,"temp_max":286.89,"pressure":1022,"sea_level":1022,"grnd_level":1017,"humidity":72,"temp_kf":-0.71},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":70},"wind":{"speed":2.84,"deg":270,"gust":3.08},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-13 00:00:00"},{"dt":1731466800,"main":{"temp":285.85,"feels_like":285.08,"temp_min":285.85,"temp_max":285.85,"pressure":1022,"sea_level":1022,"grnd_level":1018,"humidity":73,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":2.45,"deg":282,"gust":3.21},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-13 03:00:00"},{"dt":1731477600,"main":{"temp":285.45,"feels_like":284.77,"temp_min":285.45,"temp_max":285.45,"pressure":1021,"sea_level":1021,"grnd_level":1017,"humidity":78,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":98},"wind":{"speed":1.2,"deg":253,"gust":1.32},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-13 06:00:00"},{"dt":1731488400,"main":{"temp":285.18,"feels_like":284.53,"temp_min":285.18,"temp_max":285.18,"pressure":1020,"sea_level":1020,"grnd_level":1016,"humidity":80,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.1,"deg":188,"gust":1.23},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-13 09:00:00"},{"dt":1731499200,"main":{"temp":284.86,"feels_like":284.12,"temp_min":284.86,"temp_max":284.86,"pressure":1019,"sea_level":1019,"grnd_level":1015,"humidity":78,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.15,"deg":191,"gust":1.38},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-13 12:00:00"},{"dt":1731510000,"main":{"temp":284.56,"feels_like":283.71,"temp_min":284.56,"temp_max":284.56,"pressure":1019,"sea_level":1019,"grnd_level":1015,"humidity":75,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":97},"wind":{"speed":2.5,"deg":160,"gust":3.2},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-13 15:00:00"},{"dt":1731520800,"main":{"temp":286.59,"feels_like":285.63,"temp_min":286.59,"temp_max":286.59,"pressure":1019,"sea_level":1019,"grnd_level":1015,"humidity":63,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":98},"wind":{"speed":4.54,"deg":169,"gust":7.36},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-13 18:00:00"},{"dt":1731531600,"main":{"temp":287.95,"feels_like":287.26,"temp_min":287.95,"temp_max":287.95,"pressure":1017,"sea_level":1017,"grnd_level":1013,"humidity":68,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":7.2,"deg":177,"gust":11.89},"visibility":10000,"pop":0.01,"sys":{"pod":"d"},"dt_txt":"2024-11-13 21:00:00"},{"dt":1731542400,"main":{"temp":287.46,"feels_like":286.96,"temp_min":287.46,"temp_max":287.46,"pressure":1017,"sea_level":1017,"grnd_level":1013,"humidity":77,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":100},"wind":{"speed":8.32,"deg":200,"gust":11.65},"visibility":10000,"pop":0.45,"rain":{"3h":0.49},"sys":{"pod":"d"},"dt_txt":"2024-11-14 00:00:00"},{"dt":1731553200,"main":{"temp":285.98,"feels_like":285.62,"temp_min":285.98,"temp_max":285.98,"pressure":1019,"sea_level":1019,"grnd_level":1015,"humidity":88,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":49},"wind":{"speed":3.85,"deg":208,"gust":5.5},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-14 03:00:00"},{"dt":1731564000,"main":{"temp":285.7,"feels_like":285.33,"temp_min":285.7,"temp_max":285.7,"pressure":1019,"sea_level":1019,"grnd_level":1015,"humidity":89,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":26},"wind":{"speed":2.09,"deg":191,"gust":2.61},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-14 06:00:00"},{"dt":1731574800,"main":{"temp":285.43,"feels_like":285.04,"temp_min":285.43,"temp_max":285.43,"pressure":1019,"sea_level":1019,"grnd_level":1015,"humidity":89,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":4},"wind":{"speed":2.23,"deg":195,"gust":2.58},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-14 09:00:00"},{"dt":1731585600,"main":{"temp":285.06,"feels_like":284.68,"temp_min":285.06,"temp_max":285.06,"pressure":1018,"sea_level":1018,"grnd_level":1014,"humidity":91,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":49},"wind":{"speed":2.01,"deg":198,"gust":2.32},"visibility":10000,"pop":0.2,"rain":{"3h":0.12},"sys":{"pod":"n"},"dt_txt":"2024-11-14 12:00:00"},{"dt":1731596400,"main":{"temp":284.78,"feels_like":284.35,"temp_min":284.78,"temp_max":284.78,"pressure":1017,"sea_level":1017,"grnd_level":1013,"humidity":90,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":38},"wind":{"speed":2.14,"deg":172,"gust":2.4},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-14 15:00:00"},{"dt":1731607200,"main":{"temp":286.57,"feels_like":285.95,"temp_min":286.57,"temp_max":286.57,"pressure":1018,"sea_level":1018,"grnd_level":1014,"humidity":76,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":66},"wind":{"speed":2.05,"deg":200,"gust":2.69},"visibility":10000,"pop":0.2,"rain":{"3h":0.22},"sys":{"pod":"d"},"dt_txt":"2024-11-14 18:00:00"},{"dt":1731618000,"main":{"temp":287.56,"feels_like":286.75,"temp_min":287.56,"temp_max":287.56,"pressure":1016,"sea_level":1016,"grnd_level":1012,"humidity":65,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02d"}],"clouds":{"all":11},"wind":{"speed":3.36,"deg":247,"gust":3.99},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-14 21:00:00"},{"dt":1731628800,"main":{"temp":287.02,"feels_like":286.24,"temp_min":287.02,"temp_max":287.02,"pressure":1014,"sea_level":1014,"grnd_level":1010,"humidity":68,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":10},"wind":{"speed":3.88,"deg":251,"gust":4.55},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-15 00:00:00"},{"dt":1731639600,"main":{"temp":285.78,"feels_like":285.06,"temp_min":285.78,"temp_max":285.78,"pressure":1013,"sea_level":1013,"grnd_level":1010,"humidity":75,"temp_kf":0},"weather":[{"id":801,"main":"Clouds","description":"few clouds","icon":"02n"}],"clouds":{"all":11},"wind":{"speed":3.5,"deg":283,"gust":5.22},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-15 03:00:00"},{"dt":1731650400,"main":{"temp":285.08,"feels_like":284.34,"temp_min":285.08,"temp_max":285.08,"pressure":1013,"sea_level":1013,"grnd_level":1009,"humidity":77,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":51},"wind":{"speed":2.98,"deg":283,"gust":4.72},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-15 06:00:00"},{"dt":1731661200,"main":{"temp":284.53,"feels_like":283.76,"temp_min":284.53,"temp_max":284.53,"pressure":1012,"sea_level":1012,"grnd_level":1008,"humidity":78,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":3.44,"deg":295,"gust":4.99},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-15 09:00:00"},{"dt":1731672000,"main":{"temp":283.65,"feels_like":282.82,"temp_min":283.65,"temp_max":283.65,"pressure":1012,"sea_level":1012,"grnd_level":1008,"humidity":79,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":2.81,"deg":316,"gust":4.11},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-15 12:00:00"},{"dt":1731682800,"main":{"temp":283.09,"feels_like":282.64,"temp_min":283.09,"temp_max":283.09,"pressure":1013,"sea_level":1013,"grnd_level":1009,"humidity":78,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":1.59,"deg":310,"gust":2.44},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-15 15:00:00"},{"dt":1731693600,"main":{"temp":284.4,"feels_like":283.38,"temp_min":284.4,"temp_max":284.4,"pressure":1014,"sea_level":1014,"grnd_level":1010,"humidity":69,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":98},"wind":{"speed":2.05,"deg":309,"gust":2.71},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-15 18:00:00"},{"dt":1731704400,"main":{"temp":285.96,"feels_like":284.84,"temp_min":285.96,"temp_max":285.96,"pressure":1013,"sea_level":1013,"grnd_level":1009,"humidity":59,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":74},"wind":{"speed":4.26,"deg":290,"gust":4.87},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-15 21:00:00"},{"dt":1731715200,"main":{"temp":286.06,"feels_like":285.08,"temp_min":286.06,"temp_max":286.06,"pressure":1013,"sea_level":1013,"grnd_level":1009,"humidity":64,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":38},"wind":{"speed":5.85,"deg":295,"gust":6.13},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-16 00:00:00"},{"dt":1731726000,"main":{"temp":284.95,"feels_like":284.04,"temp_min":284.95,"temp_max":284.95,"pressure":1014,"sea_level":1014,"grnd_level":1010,"humidity":71,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":2.69,"deg":307,"gust":3.35},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-16 03:00:00"},{"dt":1731736800,"main":{"temp":284.3,"feels_like":283.25,"temp_min":284.3,"temp_max":284.3,"pressure":1015,"sea_level":1015,"grnd_level":1011,"humidity":68,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":2.02,"deg":353,"gust":2.3},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-16 06:00:00"},{"dt":1731747600,"main":{"temp":283.94,"feels_like":282.77,"temp_min":283.94,"temp_max":283.94,"pressure":1016,"sea_level":1016,"grnd_level":1012,"humidity":65,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":0.77,"deg":355,"gust":0.74},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-16 09:00:00"},{"dt":1731758400,"main":{"temp":283.28,"feels_like":282.1,"temp_min":283.28,"temp_max":283.28,"pressure":1016,"sea_level":1016,"grnd_level":1012,"humidity":67,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":1.2,"deg":21,"gust":1.3},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-16 12:00:00"},{"dt":1731769200,"main":{"temp":282.82,"feels_like":282.82,"temp_min":282.82,"temp_max":282.82,"pressure":1017,"sea_level":1017,"grnd_level":1013,"humidity":69,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":1.17,"deg":21,"gust":1.05},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-16 15:00:00"},{"dt":1731780000,"main":{"temp":284.47,"feels_like":283.22,"temp_min":284.47,"temp_max":284.47,"pressure":1018,"sea_level":1018,"grnd_level":1014,"humidity":60,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":1},"wind":{"speed":1.23,"deg":41,"gust":1.3},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-16 18:00:00"},{"dt":1731790800,"main":{"temp":285.95,"feels_like":284.64,"temp_min":285.95,"temp_max":285.95,"pressure":1017,"sea_level":1017,"grnd_level":1013,"humidity":52,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":4},"wind":{"speed":2.04,"deg":300,"gust":2.29},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-16 21:00:00"},{"dt":1731801600,"main":{"temp":285.62,"feels_like":284.49,"temp_min":285.62,"temp_max":285.62,"pressure":1016,"sea_level":1016,"grnd_level":1012,"humidity":60,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":3},"wind":{"speed":3.84,"deg":261,"gust":3.79},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-17 00:00:00"},{"dt":1731812400,"main":{"temp":284.28,"feels_like":283.22,"temp_min":284.28,"temp_max":284.28,"pressure":1017,"sea_level":1017,"grnd_level":1013,"humidity":68,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":3},"wind":{"speed":2.58,"deg":276,"gust":3.58},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-17 03:00:00"},{"dt":1731823200,"main":{"temp":284.17,"feels_like":283.36,"temp_min":284.17,"temp_max":284.17,"pressure":1017,"sea_level":1017,"grnd_level":1013,"humidity":78,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":1},"wind":{"speed":1.18,"deg":234,"gust":1.74},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-17 06:00:00"},{"dt":1731834000,"main":{"temp":283.87,"feels_like":283.09,"temp_min":283.87,"temp_max":283.87,"pressure":1017,"sea_level":1017,"grnd_level":1013,"humidity":80,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":1.51,"deg":201,"gust":1.88},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-17 09:00:00"},{"dt":1731844800,"main":{"temp":283.46,"feels_like":282.66,"temp_min":283.46,"temp_max":283.46,"pressure":1017,"sea_level":1017,"grnd_level":1013,"humidity":81,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":1},"wind":{"speed":1.95,"deg":172,"gust":2.15},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-11-17 12:00:00"},{"dt":1731855600,"main":{"temp":283.17,"feels_like":282.29,"temp_min":283.17,"temp_max":283.17,"pressure":1017,"sea_level":1017,"grnd_level":1013,"humidity":79,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":30},"wind":{"speed":1.28,"deg":187,"gust":1.59},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-11-17 15:00:00"}],"city":{"id":5391959,"name":"San Francisco","coord":{"lat":37.7858,"lon":-122.4064},"country":"US","population":805235,"timezone":-28800,"sunrise":1731422844,"sunset":1731459630}}%

    static func getCurrentWeatherUrl(latitude: String, longitude: String) -> URL? {
        let url = "\(Self.CURRENT_WEATHER_URL)?lat=\(latitude)&lon=\(longitude)&appid=\(Self.API_KEY)&units=metric" // static ref Self
        return URL(string: url)
    }

    static func getFiveDayForecastWeatherUrl(latitude: String, longitude: String) -> URL? {
        let url = "\(Self.FIVE_DAY_FORECAST_URL)?lat=\(latitude)&lon=\(longitude)&appid=\(Self.API_KEY)&units=metric" // static ref Self
        return URL(string: url)
    }

    static func getWeatherFromApi<T: Decodable>(url: URL, completion: @escaping (Result<T, Error>) -> Void) {
        LoggingManager.debug("getWeatherFromApi(), url: \(url)")
        let urlRequest = URLRequest(url: url)

        URLSession.shared.dataTask(with: urlRequest) { (data, response, error) in
            LoggingManager.debug("getWeatherFromApi(), urlRequest complete")

            // Check for errors
            if let error = error {
                completion(.failure(error))
                return
            }

            // Ensure we have data
            guard let dataSafe = data else {
                completion(.failure(NSError(domain: "DataError", code: -1, userInfo: [NSLocalizedDescriptionKey: "Could not load data"])))
                return
            }

            // Decode the data
            do {
                if let debugResponse = String(data: dataSafe, encoding: .utf8) {
                    LoggingManager.debug("getWeatherFromApi(), debugResponse: \(debugResponse)")
                }

                let decodedData = try JSONDecoder().decode(T.self, from: dataSafe)
                completion(.success(decodedData))
            } catch {
                completion(.failure(error))
            }
        }.resume()
    }
}
